FROM nginx:1.21-alpine

# Copy nginx config
COPY .docker/nginx/nginx.conf /etc/nginx/nginx.conf
COPY .docker/nginx/templates /etc/nginx/templates/

# Copy public folder from the app build context (assets, index.php, etc.)
COPY public /var/www/symfony/public

# Create upstream config for php-fpm
RUN echo "upstream php-upstream { server app:9000; }" > /etc/nginx/conf.d/upstream.conf

# Ensure correct permissions
RUN chown -R nginx:nginx /var/www/symfony/public

EXPOSE 80
